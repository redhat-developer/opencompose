version: '0.1-dev'

services:
- name: database
  containers:
  - image: mariadb:10
    env:
    - name: MYSQL_ROOT_PASSWORD
      secretRef: dbcreds/root_password
    - name: MYSQL_DATABASE
      value: wordpress
    - name: MYSQL_USER
      value: wordpress
    - name: MYSQL_PASSWORD
      secretRef: dbcreds/mysql_password
    ports:
    - port: 3306
  labels:
    app: db

- name: web
  containers:
  - image: wordpress:4
    env:
    - name: WORDPRESS_DB_HOST
      value: database:3306
    - name: WORDPRESS_DB_PASSWORD
      secretRef: dbcreds/web_db_password
    - name: WORDPRESS_DB_USER
      value: wordpress
    - name: WORDPRESS_DB_NAME
      value: wordpress
    ports:
    - port: 80
      type: external
  labels:
    app: web

volumes:
- name: database
  size: 100Mi
  accessMode: ReadWriteOnce

secrets:
- name: dbcreds
  data:
  - key: root_password
    file: ../mysql_root_password.txt
  - key: mysql_password
    base64: d29yZHByZXNz
  - key: web_db_password
    plaintext: wordpress

